<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>macOS Desktop UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br bg-[#6359af] text-white relative font-sans">
    <!-- Top Left Button -->
    <div class="absolute top-4 left-4">
        <button onclick="showToast()"
            class="flex items-center gap-2 px-4 py-2 bg-white/10 border border-white/20 rounded-full text-sm hover:bg-white/20 transition">
            ‚ö° Show example notification
        </button>
    </div>

    <!-- Top Right Trigger Button -->
    <div class="absolute top-4 right-4">
        <div class="relative">
            <button id="briefMeBtn"
                class="flex items-center gap-2 px-4 py-2 bg-white/10 border border-white/20 rounded-full text-sm">
                ‚ö° Brief Me
                <span id="briefStatusDot" class="w-2 h-2 rounded-full"></span>
                <span id="briefStatusLabel" class="text-white/70 capitalize">Active</span>
                <span class="ml-1 text-white/70">‚ñº</span>
            </button>

            <!-- Dropdown Panel -->
            <div id="briefMePanel"
                class="hidden absolute right-0 mt-2 w-72 bg-white text-gray-800 rounded-xl shadow-xl p-4 fade z-50">
                <h2 class="font-semibold text-lg mb-4">Brief Me</h2>

                <!-- Status Buttons -->
                <div id="statusButtons" class="flex justify-between mb-4">
                    <button class="status-btn px-3 py-1 rounded-full bg-gray-900 text-white text-sm"
                        data-status="Active">Active</button>
                    <button class="status-btn px-3 py-1 rounded-full bg-gray-100 text-sm"
                        data-status="Offline">Offline</button>
                    <button class="status-btn px-3 py-1 rounded-full bg-gray-100 text-sm" data-status="DND">DND</button>
                </div>

                <!-- Get Briefed -->
                <button id="getBriefedBtn"
                    class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-[#478c87] text-white font-semibold mb-4">
                    ‚ö° Get Briefed Now
                </button>

                <!-- Morning Brief -->
                <div class="bg-gray-100 rounded-lg p-3 mb-3 text-sm">
                    <div class="flex justify-between items-center mb-1">
                        <div class="flex items-center gap-1 text-green-600 font-medium">
                            ‚úîÔ∏è Morning Brief Ready
                        </div>
                        <button class="text-gray-500">‚úñ</button>
                    </div>
                    <div class="text-gray-500">~33 min saved so far</div>
                </div>

                <!-- Midday Brief -->
                <div class="bg-gray-100 rounded-lg p-3 mb-4 text-sm flex justify-between items-center">
                    <div class="flex items-center gap-2 text-gray-700">
                        üìÖ Midday Brief ‚Ä¢ 12:30 PM
                    </div>
                    <button class="text-blue-500">Edit ‚ûî</button>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-4 text-center text-sm font-medium text-gray-700">
                    <div>
                        <div class="text-lg font-bold">12</div>
                        Slack
                        <div class="w-2 h-2 mx-auto bg-green-500 rounded-full mt-1"></div>
                    </div>
                    <div>
                        <div class="text-lg font-bold">8</div>
                        Notion
                        <div class="w-2 h-2 mx-auto bg-green-500 rounded-full mt-1"></div>
                    </div>
                    <div>
                        <div class="text-lg font-bold">5</div>
                        Teams
                        <div class="w-2 h-2 mx-auto bg-gray-300 rounded-full mt-1"></div>
                    </div>
                    <div>
                        <div class="text-lg font-bold">3</div>
                        Mail
                        <div class="w-2 h-2 mx-auto bg-gray-300 rounded-full mt-1"></div>
                    </div>
                </div>

                <!-- Bottom Buttons -->
                <div class="mt-4 flex justify-center gap-6">
                    <button class="w-10 h-10 bg-black text-white rounded-full">‚ö°</button>
                    <button id="statusChangeBtn"
                        class="w-10 h-10 bg-black text-white rounded-full flex items-center justify-center">
                        <div id="statusDot" class="w-3 h-3 bg-green-400 rounded-full"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Catch Me Up Modal -->
    <div id="catchMeUpModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 text-white rounded-xl p-6 w-full max-w-md shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-lg font-semibold">‚ö° Catch Me Up</h2>
                    <p class="text-sm text-gray-400">Get a summary of what you've missed while you were away</p>
                </div>
                <button id="closeModalBtn" class="text-gray-400 hover:text-white text-xl font-bold">&times;</button>
            </div>
            <div class="bg-gray-800 rounded-md px-4 py-2 text-sm mb-4">
                We detected you've been offline for <span class="text-blue-400 font-medium">3 hours</span>
            </div>
            <div class="space-y-3">
                <label class="flex items-center gap-2">
                    <input type="radio" name="timeOption" class="accent-green-500" value="detected" checked>
                    <span>Use detected time (3 hours)</span>
                </label>
                <label class="flex items-center gap-2">
                    <input type="radio" name="timeOption" class="accent-green-500" value="custom">
                    <span>Set custom time period</span>
                </label>
                <div id="customTimePanel" class="bg-gray-800 p-4 rounded-md space-y-3 hidden">
                    <div class="flex gap-2">
                        <input type="date" id="customDate"
                            class="bg-gray-700 border border-gray-600 rounded px-2 py-1 w-full text-sm text-white">
                        <input type="time" id="customTime"
                            class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm text-white w-1/2">
                    </div>
                    <div class="text-sm text-gray-400">
                        End Time (Current): <span class="text-white">Jul 15, 2025 at 14:41</span>
                    </div>
                    <div class="flex gap-2">
                        <button type="button" class="quick-duration-btn text-sm bg-gray-700 px-3 py-1 rounded-md"
                            data-hours="1">1 hr</button>
                        <button type="button" class="quick-duration-btn text-sm bg-gray-700 px-3 py-1 rounded-md"
                            data-hours="4">4 hr</button>
                        <button type="button" class="quick-duration-btn text-sm bg-gray-700 px-3 py-1 rounded-md"
                            data-hours="24">24 hr</button>
                    </div>
                    <input type="range" min="1" max="24" value="3" id="durationSlider" class="w-full accent-green-500">
                    <div class="text-right text-sm text-gray-300">
                        Duration: <span id="durationLabel">3 hr</span>
                    </div>
                </div>
            </div>
            <div class="flex justify-end mt-6 gap-3">
                <button id="cancelModalBtn" class="px-4 py-2 bg-gray-700 rounded-md text-sm hover:bg-gray-600">‚úñ
                    Cancel</button>
                <button class="px-4 py-2 bg-[#499185] text-white rounded-md text-sm hover:bg-[#337267]">
                    ‚ö° Generate Summary
                </button>
            </div>
        </div>
    </div>

    <!-- Center Content -->
    <div class="flex flex-col items-center justify-center text-center min-h-screen px-4">
        <h1 class="text-4xl sm:text-5xl font-light mb-4">macOS Desktop</h1>
        <p class="text-lg sm:text-xl mb-8">Click the menu bar to access Brief Me or cycle through status by clicking the
            button</p>

        <!-- Card -->
        <div class="bg-white/10 border border-white/20 p-6 rounded-xl max-w-xl">
            <h2 class="text-xl font-semibold mb-2">Smart Interrupt System</h2>
            <p class="text-sm text-white/90">
                Brief Me monitors all your communications silently in the background. Only the most critical
                messages‚Äîfrom priority contacts or containing emergency keywords‚Äîbreak through as interrupt
                notifications. Everything else waits for your next brief, keeping you focused while ensuring you never
                miss what truly matters.
            </p>
        </div>
    </div>

    <!-- Feedback Button -->
    <div class="fixed right-0 top-1/2 -translate-y-1/2 rotate-180 origin-bottom-right">
        <button
            class="bg-white/10 border border-white/20 text-sm px-2 py-1 rounded-l-lg transform -rotate-90 hover:bg-white/20 transition">
            Feedback
        </button>
    </div>
    
    <div id="toast" class="hidden fixed top-6 right-6 w-96 bg-gray-900 text-white rounded-xl shadow-lg z-50 animate-fade-in-down">
       <div class="flex justify-end">
         <button onclick="hideToast()" class="hover:text-white mr-5">‚úñ</button>
       </div>
        <div id="messageList"
            class="flex flex-col gap-10 max-h-[27rem] overflow-scroll">
            
        </div>
    </div>

    <style>
        @keyframes fade-in-down {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-down {
            animation: fade-in-down 0.3s ease-out;
        }
    </style>

    <!-- Scripts -->
    <script src="js/helper.js"></script>
    <script src="js/slackStatus.js"></script>

    <script>
        const btn = document.getElementById('briefMeBtn');
        const panel = document.getElementById('briefMePanel');

        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            panel.classList.toggle('hidden');
        });

        document.addEventListener('click', (e) => {
            if (!panel.contains(e.target) && !btn.contains(e.target)) {
                panel.classList.add('hidden');
            }
        });

        const briefStatusDot = document.getElementById('briefStatusDot');
        const statusDot = document.getElementById('statusDot');
        // Modal logic
        const getBriefedBtn = document.getElementById('getBriefedBtn');
        const catchMeUpModal = document.getElementById('catchMeUpModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelModalBtn = document.getElementById('cancelModalBtn');
        const durationLabel = document.getElementById('durationLabel');
        const durationSlider = document.getElementById('durationSlider');
        const customTimePanel = document.getElementById('customTimePanel');
        const timeOptions = document.querySelectorAll('input[name="timeOption"]');
        const quickButtons = document.querySelectorAll('.quick-duration-btn');

        getBriefedBtn.addEventListener('click', () => {
            catchMeUpModal.classList.remove('hidden');
        });

        [closeModalBtn, cancelModalBtn].forEach(btn => {
            btn.addEventListener('click', () => {
                catchMeUpModal.classList.add('hidden');
            });
        });

        timeOptions.forEach(option => {
            option.addEventListener('change', () => {
                if (option.value === 'custom' && option.checked) {
                    customTimePanel.classList.remove('hidden');
                } else {
                    customTimePanel.classList.add('hidden');
                }
            });
        });

        quickButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const hours = btn.dataset.hours;
                durationSlider.value = hours;
                durationLabel.textContent = `${hours} hr`;
            });
        });

        durationSlider.addEventListener('input', () => {
            durationLabel.textContent = `${durationSlider.value} hr`;
        });

        function showToast() {
            document.getElementById('toast').classList.remove('hidden');
        }

        function hideToast() {
            document.getElementById('toast').classList.add('hidden');
        }

        function createMessageItem(message) {
            return `
            <div class="p-4 border-b-4 border-gray-700 flex items-start gap-3">
                <div class="flex-shrink-0 pt-1">
                      <span class="w-3 h-3 bg-red-500 rounded-full block"></span>
                  </div>
                  <div class="flex-1">
                      <p class="text-sm font-semibold uppercase text-gray-400">Brief Me Interrupt <span class="text-red-400 font-semibold">(${message?.source})</span></p>
                      <div class="mt-1 flex items-center gap-2 text-sm">
                          <span id="senderName" class="font-bold">${message?.from}</span>
                          <span id="teamInfo" class="text-gray-400">‚Ä¢  ${message?.subject ?? 'No message'}</span>
                      </div>
                      <p class="mt-1 text-sm leading-snug text-gray-100" id="messageText">
                          ${message?.content}
                      </p>
                      <div class="mt-3 flex gap-2">
                          <button class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm">Reply</button>
                          <button class="bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded text-sm">View Thread</button>
                      </div>
                  </div>
            </div>
                  `;
        }

        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const response = await fetch(`${BASE_URL}/emergency-messages`, {
                    method: "GET",
                    headers: {
                        Authorization: `Bearer ${token}`,
                        "Content-Type": "application/json",
                    },
                });

                if (!response.ok) {
                    alert("Failed to fetch emergency messages. Status: " + response.status);
                    return;
                }

                const emergencyMessages = await response.json();

                if (emergencyMessages?.data?.length > 0) {
                    const messageList = document.getElementById("messageList");

                    messageList.innerHTML = emergencyMessages?.data?.map(createMessageItem).join("");
                    showToast();
                }

            } catch (err) {
                alert("Error:\n" + JSON.stringify(err, null, 2));
            }
        });


    </script>
</body>

</html>